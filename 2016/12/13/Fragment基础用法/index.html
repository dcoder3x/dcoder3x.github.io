<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Fragment基础用法 | Hexo blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Hexo blog</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Fragment基础用法</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-12-13</div><div class="post-tags"><a class="post-tag-link" href="/tags/Android/">Android</a>/<a class="post-tag-link" href="/tags/Fragment/">Fragment</a></div></div></div><article><div class="container post"><h2 id="创建一个Fragment类"><a href="#创建一个Fragment类" class="headerlink" title="创建一个Fragment类"></a>创建一个Fragment类</h2><ul>
<li>继承Fragment类</li>
<li>定义xml布局</li>
</ul>
<p>ArticleFragment.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="comment">// Activity use support library,Fragment also need support library</span></div><div class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></div><div class="line">        Bundle savedInstanceState) &#123;</div><div class="line">        <span class="comment">// Inflate the layout for this fragment</span></div><div class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.article_view, container, <span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>article_view.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!--   TODO   --&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="直接在Activity对应的xml中使用ArticleFragment"><a href="#直接在Activity对应的xml中使用ArticleFragment" class="headerlink" title="直接在Activity对应的xml中使用ArticleFragment"></a>直接在Activity对应的xml中使用ArticleFragment</h2><p>activity_main.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"fill_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">fragment</span> <span class="attr">android:name</span>=<span class="string">"com.example.android.fragments.HeadlinesFragment"</span></span></div><div class="line">              <span class="attr">android:id</span>=<span class="string">"@+id/headlines_fragment"</span></div><div class="line">              <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">fragment</span> <span class="attr">android:name</span>=<span class="string">"com.example.android.fragments.ArticleFragment"</span></span></div><div class="line">              <span class="attr">android:id</span>=<span class="string">"@+id/article_fragment"</span></div><div class="line">              <span class="attr">android:layout_weight</span>=<span class="string">"2"</span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>Fragment的包名必须写明。</p>
</blockquote>
<h2 id="在代码中动态添加Fragment"><a href="#在代码中动态添加Fragment" class="headerlink" title="在代码中动态添加Fragment"></a>在代码中动态添加Fragment</h2><ol>
<li><p>xml中定义ViewGroup容纳Fragment，添加id。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/fragment_container"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>代码中使用FragmentManager添加Fragment。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentActivity;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">FragmentActivity</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.news_articles);</div><div class="line">        <span class="keyword">if</span> (findViewById(R.id.fragment_container) != <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line">            <span class="comment">// However, if we're being restored from a previous state,</span></div><div class="line">            <span class="comment">// then we don't need to do anything and should return or else</span></div><div class="line">            <span class="comment">// we could end up with overlapping fragments.</span></div><div class="line">            <span class="keyword">if</span> (savedInstanceState != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            HeadlinesFragment firstFragment = <span class="keyword">new</span> HeadlinesFragment();</div><div class="line"></div><div class="line">            firstFragment.setArguments(getIntent().getExtras());</div><div class="line"></div><div class="line">            getSupportFragmentManager().beginTransaction()</div><div class="line">                    .add(R.id.fragment_container, firstFragment).commit();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意获得FragmentManager使用getSupportFragmentManager方法，因为Activity继承自支持库的Activity。</p>
</blockquote>
<h2 id="在单个Activity里替换不同的Fragment"><a href="#在单个Activity里替换不同的Fragment" class="headerlink" title="在单个Activity里替换不同的Fragment"></a>在单个Activity里替换不同的Fragment</h2><p>要注意的几个要点</p>
<ul>
<li>实现Fragment定义的接口回调方法</li>
<li>add(),remove(),replace(),hide(),show(),等方法</li>
<li>清除返回栈，popBackStack()等方法</li>
<li>屏幕旋转导致的Fragment重叠显示问题</li>
</ul>
<h4 id="定义接口并实现回调方法"><a href="#定义接口并实现回调方法" class="headerlink" title="定义接口并实现回调方法"></a>定义接口并实现回调方法</h4><p>在Fragment里定义回调接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadlinesFragment</span> <span class="keyword">extends</span> <span class="title">ListFragment</span> </span>&#123;</div><div class="line">    OnHeadlineSelectedListener mCallback;</div><div class="line"></div><div class="line">    <span class="comment">// Container Activity must implement this interface</span></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnHeadlineSelectedListener</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onAttach(activity);</div><div class="line"></div><div class="line">        <span class="comment">// This makes sure that the container activity has implemented</span></div><div class="line">        <span class="comment">// the callback interface. If not, it throws an exception</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mCallback = (OnHeadlineSelectedListener) activity;</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassCastException(activity.toString()</div><div class="line">                    + <span class="string">" must implement OnHeadlineSelectedListener"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onListItemClick</span><span class="params">(ListView l, View v, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">        <span class="comment">// Send the event to the host activity</span></div><div class="line">        mCallback.onArticleSelected(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在Activity里实现接口的回调方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></div><div class="line">        <span class="keyword">implements</span> <span class="title">HeadlinesFragment</span>.<span class="title">OnHeadlineSelectedListener</span>&#123;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="comment">// The user selected the headline of an article from the HeadlinesFragment</span></div><div class="line">        <span class="comment">// Do something here to display that article</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="控制Fragment的几个方法"><a href="#控制Fragment的几个方法" class="headerlink" title="控制Fragment的几个方法"></a>控制Fragment的几个方法</h4><p>add()</p>
<p>向Activity添加Fragment，应该检查Activity的framelayout容器里是否已有Fragment，进而决定是否移除或隐藏原有Fragment.</p>
<p>hide()</p>
<p>用来隐藏当前的Fragment，Fragment只是变为不可见，并没有销毁，甚至你还能与该Fragment交互。</p>
<p>show()</p>
<p>跟hide()相对应，通过show()显示别隐藏的那个Fragment。</p>
<p>remove()</p>
<p>移除Fragment，这通常意味着该Fragment被销毁。(加入返回栈并不销毁Fragment)</p>
<p>replace()</p>
<p>移除原有Fragment并添加新的Fragment，在加入返回栈的情况下，原有Fragment不会被销毁。</p>
<blockquote>
<p>具体使用hide()或者remove()哪个方法，取决于应用的逻辑和具体需求。如果使用FragmentTransaction隐藏片段，那么它仍然可以处于其生命周期的运行状态，但是它的UI已经从窗口分离，因此它不再可见。 所以你可以技术上仍然与片段交互，并重新连接它的UI在你需要时。 如果你替换片段，你实际上是把它从容器中剥离，它将通过生命周期中所有的拆卸事件（onPause，onStop等），如果由于某种原因你需要该片段，你将不得不将其插回到容器中，并让它再次运行所有的初始化。</p>
<p>对于hide和show,他们经常被用在单个Activity页面不同Fragment的导航。</p>
</blockquote>
<h4 id="Fragment返回栈的使用"><a href="#Fragment返回栈的使用" class="headerlink" title="Fragment返回栈的使用"></a>Fragment返回栈的使用</h4><p>如果将Fragment加入返回栈，那么在按返回键的时候。系统将会像处理Activity那样处理返回栈内记录的Fragment。也可以通过调用FragmentManager的相应方法弹出返回栈内的某个Fragment记录，甚至是清空整个返回栈的Fragment记录。返回栈还有通过tag指定或寻找某个Fragment等更高级的用法。</p>
<blockquote>
<p>不要将第一个加入Activity的Fragment添加进返回栈，这可能会导致最后一次返回时不能正确退出应用。</p>
</blockquote>
<h4 id="Fragment重叠"><a href="#Fragment重叠" class="headerlink" title="Fragment重叠"></a>Fragment重叠</h4><p>在屏幕旋转或系统kill Activity的某些情况下，重新创建的Activity可能出现Fragment重叠的问题。<br>主要原因是onSaveInstanceState()保存了意外销毁的Fragment，并在onRestoreInstanceState()方法中恢复了该Fragment。但在Activity的onCreate方法重新调用时又创建了一遍Fragment。上边创建Fragment时，Google的代码里已经说明了这个问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (findViewById(R.id.fragment_container) != <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line">    <span class="comment">// However, if we're being restored from a previous state,</span></div><div class="line">    <span class="comment">// then we don't need to do anything and should return or else</span></div><div class="line">    <span class="comment">// we could end up with overlapping fragments.</span></div><div class="line">    <span class="keyword">if</span> (savedInstanceState != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    HeadlinesFragment firstFragment = <span class="keyword">new</span> HeadlinesFragment();</div><div class="line"></div><div class="line">    firstFragment.setArguments(getIntent().getExtras());</div><div class="line"></div><div class="line">    getSupportFragmentManager().beginTransaction()</div><div class="line">            .add(R.id.fragment_container, firstFragment).commit();</div></pre></td></tr></table></figure>
<blockquote>
<p>创建Fragment前判断savedInstanceState是否保存了内容，如果有那就不要重新创建了。</p>
</blockquote>
<h2 id="不同Fragment之间的交互"><a href="#不同Fragment之间的交互" class="headerlink" title="不同Fragment之间的交互"></a>不同Fragment之间的交互</h2><ul>
<li>setArguments方式</li>
<li>使用Fragment内定义的newInstance()带参方法创建Fragment</li>
</ul>
<p>两种方法的本质是一样的。但通过Fragment定义Bundle的方式，强制该Fragment使用者传入参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> WeatherFragment <span class="title">newInstance</span><span class="params">(String param1)</span> </span>&#123;</div><div class="line">    WeatherFragment fragment = <span class="keyword">new</span> WeatherFragment();</div><div class="line">    Bundle args = <span class="keyword">new</span> Bundle();</div><div class="line">    args.putString(MainActivity.BUNDLE_INFO, param1);</div><div class="line">    fragment.setArguments(args);</div><div class="line">    <span class="keyword">return</span> fragment;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2016 <a href="/" rel="nofollow">dcoder3x</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>